<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rpigpior">
<title>Raspberry Pi and PWM • rpigpior</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Raspberry Pi and PWM">
<meta property="og:description" content="rpigpior">
<meta property="og:image" content="https://mnr.github.io/rpigpior/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rpigpior</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/R_and_RPi.html">R_and_RPi</a>
    <a class="dropdown-item" href="../articles/Cookbook.html">Use I2C for BME280</a>
    <a class="dropdown-item" href="../articles/gpioCode.html">How to write GPIO Code with rpigpiodr and R</a>
    <a class="dropdown-item" href="../articles/how-to-RPi.html">How to Setup R on Raspberry Pi</a>
    <a class="dropdown-item" href="../articles/rpi_i2c.html">rpi_i2c</a>
    <a class="dropdown-item" href="../articles/rpi_pwm.html">Raspberry Pi and PWM</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mnr/rpigpior/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Raspberry Pi and PWM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mnr/rpigpior/blob/HEAD/vignettes/articles/rpi_pwm.Rmd" class="external-link"><code>vignettes/articles/rpi_pwm.Rmd</code></a></small>
      <div class="d-none name"><code>rpi_pwm.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mnr/rpigpior" class="external-link">rpigpior</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="pulse-width-modulation-on-the-raspberry-pi">Pulse Width Modulation on the Raspberry Pi<a class="anchor" aria-label="anchor" href="#pulse-width-modulation-on-the-raspberry-pi"></a>
</h2>
<div class="section level3">
<h3 id="hardware-pwm-vs-software-pwm">Hardware PWM vs Software PWM<a class="anchor" aria-label="anchor" href="#hardware-pwm-vs-software-pwm"></a>
</h3>
<p>The Raspberry Pi exposes two PWM channels from the Broadcom chip.
These appear on lines which also supply GPIO connections and so the
Broadcom ALT functions need to be called.</p>
<ul>
<li><p>PWM0 appears on board pins 12 (GPIO18) and 32 (GPIO12).</p></li>
<li><p>PWM1 appears on board pins 33 (GPIO13) and 35 (GPIO19).</p></li>
</ul>
<p>This causes a confusing situation in two ways:</p>
<ul>
<li>Don’t confuse board pin 12 with GPIO12 (board pin 32). Both are
connected to BCM PWM0</li>
<li>If you want to use two PWM channels, there are only certain
combinations of pins that will provide the two channels. These
combinations are board pins (12,33), (32,33), (12,35), or (32,35)</li>
</ul>
<p><code><a href="../reference/rpi_pwm.html">rpi_pwm()</a></code> handles these issues. If you stick to board
pin numbers, it will all work out. If you go astray,
<code><a href="../reference/rpi_pwm.html">rpi_pwm()</a></code> will <code>stop</code> and warn you.</p>
<p>The Raspberry Pi analog audio output uses both PWM channels. You
can’t use hardware PWM and audio output at the same time.</p>
<p>Although it is possible to create software PWM, this isn’t advised
due to latency of linux and R. <code>rpigpior</code> does not supply any
software PWM channels.</p>
</div>
<div class="section level3">
<h3 id="enabling-hardware-pwm-on-the-raspberry-pi">Enabling hardware PWM on the Raspberry Pi<a class="anchor" aria-label="anchor" href="#enabling-hardware-pwm-on-the-raspberry-pi"></a>
</h3>
<p><em>Raspberry Pi OS</em> uses the device tree to enable hardware PWM.
You’ll need to do a bit of behind-the-scenes editing to set this up.</p>
<p>To do this, edit /boot/config.txt as root.</p>
<ol style="list-style-type: decimal">
<li><p>On the Raspberry Pi, open a terminal window</p></li>
<li><p>Use the command <code>sudo nano /boot/config.txt</code>. This
will open the nano text editor and display the contents of
/boot/config.txt.</p></li>
<li><p>Add the <code>dtoverlay</code> command at the end of the file.
The easiest way to determine the command to add to
<code>/boot/config.txt</code> is to ask <code><a href="../reference/rpi_pwm.html">rpi_pwm()</a></code> for help.
Set <code>pwm_debug=TRUE</code> then select the pins you want to use. If
they aren’t enabled, <code><a href="../reference/rpi_pwm.html">rpi_pwm()</a></code> will stop and provide you
with the correct <code>dtoverlay</code> string. This looks something
like <code>dtoverlay=pwm,pin18,func-2</code> but will change depending
on the pins you have chosen.<br><br>
If you want to do the math yourself, there is an excellent guide
available at <a href="https://github.com/dotnet/iot/blob/main/Documentation/raspi-pwm.md" class="external-link">github.com/dotnet</a>.
There is also linux documentation that discusses <a href="https://github.com/raspberrypi/linux/blob/04c8e47067d4873c584395e5cb260b4f170a99ea/arch/arm/boot/dts/overlays/README#L925" class="external-link">Enabling
one PWM channel</a> or <a href="https://github.com/raspberrypi/linux/blob/04c8e47067d4873c584395e5cb260b4f170a99ea/arch/arm/boot/dts/overlays/README#L944" class="external-link">Enabling
a dual pwm channel</a></p></li>
<li><p>Use <em>control-o</em> to write the file, then <em>control-x</em>
to exit <code>nano</code></p></li>
<li><p>Reboot your Raspberry Pi to enact this change.</p></li>
</ol>
<p>Note that if you rebuild your SD card or reinstall Raspberry Pi OS on
the OS card, you’ll need to repeat this step.</p>
</div>
<div class="section level3">
<h3 id="how-to-use-rpi_pwm">How to use <code>rpi_pwm()</code><a class="anchor" aria-label="anchor" href="#how-to-use-rpi_pwm"></a>
</h3>
<p>Here’s an example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rpi_pwm.html">rpi_pwm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>,<span class="fl">33</span><span class="op">)</span>, pwm_period <span class="op">=</span> <span class="fl">50000</span>, pwm_dutycycle <span class="op">=</span> <span class="fl">25000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This will enable PWM0 and PWM1 with a period (frequency) of 50000 and a duty cycle of 25000. That is to say, 50% power.</span></span></code></pre></div>
<p>Or…</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rpi_pwm.html">rpi_pwm</a></span><span class="op">(</span><span class="fl">12</span>, pwm_period <span class="op">=</span> <span class="fl">50000</span>, pwm_dutycycle <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This will turn PWM0 down to 20%</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="handling-errors">Handling Errors:<a class="anchor" aria-label="anchor" href="#handling-errors"></a>
</h3>
<p>If you set <code>pwm_debug = TRUE</code> then <code><a href="../reference/rpi_pwm.html">rpi_pwm()</a></code>
will run diagnostics as it goes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rpi_pwm.html">rpi_pwm</a></span><span class="op">(</span><span class="fl">12</span>, pwm_period <span class="op">=</span> <span class="fl">50000</span>, pwm_dutycycle <span class="op">=</span> <span class="fl">10000</span>, pwm_debug <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="invalid-pwm-pin">Invalid PWM pin:<a class="anchor" aria-label="anchor" href="#invalid-pwm-pin"></a>
</h4>
<p>You’ve called <code>rpi_pwm(pin_number)</code> where the pin (or
pins) specified don’t supply hardware Pulse Width Modulation. On the
Raspberry Pi, this is only board pins 12, 32, 33, or 35. Keep in mind
<code><a href="../reference/rpi_pwm.html">rpi_pwm()</a></code> only specifies pins as board pins - not GPIO or
BCM pins. Lots of documentation will refer to these other pin numbering
schemes.</p>
</div>
<div class="section level4">
<h4 id="invalid-pwm-pin-combination">Invalid PWM pin combination:<a class="anchor" aria-label="anchor" href="#invalid-pwm-pin-combination"></a>
</h4>
<p>As you know by now, the Raspberry Pi only has two hardware PWM
channels, but each channel is connected to two pins:</p>
<ul>
<li><p>PWM0 appears on board pins 12 (GPIO18) and 32 (GPIO12).</p></li>
<li><p>PWM1 appears on board pins 33 (GPIO13) and 35 (GPIO19).</p></li>
</ul>
<p>So…if you are going to use two PWM channels, you need to use pins
connected to different channels. Since board pin 12 and 32 are both
connected to PWM0, it would be nonsense to use
<code>rpi_pwm(pin_number = c(12,32)</code>. Instead, these are the valid
combinations:</p>
<ul>
<li><code>rpi_pwm(pin_number = c(12,33)</code></li>
<li><code>rpi_pwm(pin_number = c(12,35)</code></li>
<li><code>rpi_pwm(pin_number = c(32,33)</code></li>
<li><code>rpi_pwm(pin_number = c(32,35)</code></li>
</ul>
<p>If you try to select an invalid combination and
<code>pwm_debut = TRUE</code> you will receive an error.</p>
</div>
<div class="section level4">
<h4 id="pwm-not-enabled">PWM not enabled:<a class="anchor" aria-label="anchor" href="#pwm-not-enabled"></a>
</h4>
<p>The PWM channel (or channels) you have selected are not yet enabled.
Enabling PWM is described in the above section titled <a href="#enabling-hardware-pwm-on-the-raspberry-pi">Enabling hardware PWM
on the Raspberry Pi</a> . The error message from <code>rpi_pwm</code>
supplies the string you’ll need to paste into
<code>/boot/config.txt</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="notes">Notes:<a class="anchor" aria-label="anchor" href="#notes"></a>
</h3>
<p>The Linux driver implementer’s API guide has a chapter on PWM : <a href="https://www.kernel.org/doc/html/v5.10/driver-api/pwm.html" class="external-link uri">https://www.kernel.org/doc/html/v5.10/driver-api/pwm.html</a></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mark Niemann-Ross.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
