<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rpigpior">
<title>Use I2C for BME280 • rpigpior</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use I2C for BME280">
<meta property="og:description" content="rpigpior">
<meta property="og:image" content="https://mnr.github.io/rpigpior/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rpigpior</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/R_and_RPi.html">R_and_RPi</a>
    <a class="dropdown-item" href="../articles/gpioCode.html">How to write GPIO Code with rpigpiodr and R</a>
    <a class="dropdown-item" href="../articles/how-to-RPi.html">How to Setup R on Raspberry Pi</a>
    <a class="dropdown-item" href="../articles/i2cbme280.html">Use I2C for BME280</a>
    <a class="dropdown-item" href="../articles/rpi_i2c.html">rpi_i2c</a>
    <a class="dropdown-item" href="../articles/rpi_pwm.html">Raspberry Pi and PWM</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mnr/rpigpior/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Use I2C for BME280</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mnr/rpigpior/blob/HEAD/vignettes/articles/i2cbme280.Rmd" class="external-link"><code>vignettes/articles/i2cbme280.Rmd</code></a></small>
      <div class="d-none name"><code>i2cbme280.Rmd</code></div>
    </div>

    
    
<p>This article shows an example of using <code>rpi_i2c…</code> to
communicate with a BME280 sensor chip.</p>
<div class="section level2">
<h2 id="bme280">BME280<a class="anchor" aria-label="anchor" href="#bme280"></a>
</h2>
<p>The BME280 <a href="https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bme280-ds002.pdf" class="external-link">(Datasheet)</a>
by Bosch is a versatile integrated environmental sensor designed for
precision measurement of ambient temperature, relative humidity, and
atmospheric pressure. This compact and low-power sensor is equipped with
advanced MEMS (Micro-Electro-Mechanical Systems) technology, providing
accurate and reliable data for various applications, including weather
forecasting, indoor climate control, and IoT devices. Its I2C and SPI
communication interfaces make it easy to interface with microcontrollers
and microprocessors, while its small form factor and energy efficiency
make it an ideal choice for a wide range of projects, from weather
stations to wearable tech, where monitoring and controlling
environmental conditions are paramount.</p>
</div>
<div class="section level2">
<h2 id="setup-for-the-bme280">Setup for the BME280<a class="anchor" aria-label="anchor" href="#setup-for-the-bme280"></a>
</h2>
<p>Please refer to the <a href="rpi_i2c.Rmd">article</a> on using i2c
with R on the Raspberry Pi. You’ll need to enable I2C (using Raspberry
Pi Configuration) and find the address for the BME280 (using
<code>i2c-tools -y 1</code>)</p>
<p>To confirm the chip is connected and available, use
<code>rpi_i2c_get(chip_address = BME280_location, data_address= 0xD0)</code>.
Depending on the implementation you have purchased, the BME280 may also
appear at chip address 0x76, in which case you would use
<code>rpi_i2c_get(chip_address = 0x76, data_address= 0xD0).</code> This
command should return the BME Chip ID, <code>0x60</code></p>
</div>
<div class="section level2">
<h2 id="read-the-bme280">Read the BME280<a class="anchor" aria-label="anchor" href="#read-the-bme280"></a>
</h2>
<p>The BME280 datasheet provides this flowchart for reading the
sensors.</p>
<div class="figure">
<img src="bme280MeasurementFlow.png" alt=""><p class="caption">BME280 measurement flow from data sheet</p>
</div>
<p>Here is code to read temperature, pressure, and humidity from the
bme280 with i2c. It leans heavily on the source found at <a href="https://github.com/boschsensortec/BME280_driver/blob/master/bme280.c" class="external-link">github.com/boschsensortec</a>.
This is simplified, it does not:</p>
<ul>
<li><p>compensate for sensor calibration</p></li>
<li><p>worry about reading data between cycles</p></li>
<li><p>provide readings at maximum resolution</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mnr/rpigpior" class="external-link">rpigpior</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mmaechler/R-bitops" class="external-link">bitops</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">BME280_location</span> <span class="op">&lt;-</span> <span class="fl">0x77</span> <span class="co">#possibly change to 0x76</span></span>
<span></span>
<span><span class="co"># locations of BME280 registers as identified in datasheet</span></span>
<span><span class="va">BME280_id</span> <span class="op">&lt;-</span> <span class="fl">0xD0</span> <span class="co"># 0x60 for BME280</span></span>
<span><span class="va">BME280_reset</span> <span class="op">&lt;-</span> <span class="fl">0xE0</span></span>
<span><span class="va">BME280_ctrl_hum</span> <span class="op">&lt;-</span> <span class="fl">0xF2</span></span>
<span><span class="va">BME280_status</span> <span class="op">&lt;-</span> <span class="fl">0xF3</span></span>
<span><span class="va">BME280_ctrl_meas</span> <span class="op">&lt;-</span> <span class="fl">0xF4</span></span>
<span><span class="va">BME280_config</span> <span class="op">&lt;-</span> <span class="fl">0xF5</span></span>
<span><span class="va">BME280_press</span> <span class="op">&lt;-</span> <span class="fl">0xF7</span> <span class="co"># through 0xF9. _msb, _lsb, _xlsb</span></span>
<span><span class="va">BME280_temp</span> <span class="op">&lt;-</span> <span class="fl">0xFA</span> <span class="co"># through 0xFC. _msb, _lsb, _xlsb</span></span>
<span><span class="va">BME280_hum</span> <span class="op">&lt;-</span> <span class="fl">0xFD</span> <span class="co"># through 0xFE. _msb, _lsb, _xlsb</span></span>
<span></span>
<span><span class="co"># start measurement cycle ------------------</span></span>
<span><span class="co"># set configuration values</span></span>
<span><span class="va">config_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strtoi.html" class="external-link">strtoi</a></span><span class="op">(</span><span class="st">"01000000"</span>, base <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># t_sb = 125 ms/IIR_filter = off /spi3w_en = off</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rpi_i2c_set.html">rpi_i2c_set</a></span><span class="op">(</span></span>
<span>  chip_address <span class="op">=</span> <span class="va">BME280_location</span>,</span>
<span>  data_address <span class="op">=</span> <span class="va">BME280_config</span>,</span>
<span>  value <span class="op">=</span> <span class="va">config_value</span>,</span>
<span>  data_size <span class="op">=</span> <span class="st">"b"</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># set humidity data acquisition options</span></span>
<span><span class="va">ctrl_hum_value</span> <span class="op">&lt;-</span> <span class="fl">0x01</span> <span class="co"># humidity oversampling set to 1</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rpi_i2c_set.html">rpi_i2c_set</a></span><span class="op">(</span></span>
<span>  chip_address <span class="op">=</span> <span class="va">BME280_location</span>,</span>
<span>  data_address <span class="op">=</span> <span class="va">BME280_ctrl_hum</span>,</span>
<span>  value <span class="op">=</span> <span class="va">ctrl_hum_value</span>,</span>
<span>  data_size <span class="op">=</span> <span class="st">"b"</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># set pressure &amp; temperature data acquisition options</span></span>
<span><span class="va">ctrl_meas_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strtoi.html" class="external-link">strtoi</a></span><span class="op">(</span><span class="st">"00100101"</span>, base <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># osrs_t/osrs_p/mode</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rpi_i2c_set.html">rpi_i2c_set</a></span><span class="op">(</span></span>
<span>   chip_address <span class="op">=</span> <span class="va">BME280_location</span>,</span>
<span>   data_address <span class="op">=</span> <span class="va">BME280_ctrl_meas</span>,</span>
<span>   value <span class="op">=</span> <span class="va">ctrl_meas_value</span>,</span>
<span>   data_size <span class="op">=</span> <span class="st">"b"</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># read raw temperature ---------------------</span></span>
<span><span class="va">raw_temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpi_i2c_get.html">rpi_i2c_get</a></span><span class="op">(</span><span class="va">BME280_location</span>, <span class="va">BME280_temp</span>, <span class="st">"w"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read raw pressure ----------------------</span></span>
<span><span class="va">raw_pressure</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpi_i2c_get.html">rpi_i2c_get</a></span><span class="op">(</span><span class="va">BME280_location</span>, <span class="va">BME280_press</span>, <span class="st">"w"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read raw humidity ----------------------</span></span>
<span><span class="va">raw_humidity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpi_i2c_get.html">rpi_i2c_get</a></span><span class="op">(</span><span class="va">BME280_location</span>, <span class="va">BME280_hum</span>, <span class="st">"w"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for testing</span></span>
<span><span class="va">humidity</span> <span class="op">&lt;-</span> <span class="va">raw_humidity</span></span>
<span><span class="va">pressure</span> <span class="op">&lt;-</span> <span class="va">raw_pressure</span></span>
<span><span class="va">temperature_celsius</span> <span class="op">&lt;-</span> <span class="va">raw_temperature</span></span>
<span></span>
<span><span class="co"># print humidty_percentage, pressure, temperature_celsius</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"humidity:"</span>, <span class="va">humidity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"pressure:"</span>, <span class="va">pressure</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"temperature (c):"</span>, <span class="va">temperature_celsius</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># control_press_temp &lt;- strtoi("00000001", base = 2)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # get the humidity</span></span>
<span><span class="co">#   sample_hum &lt;- 0x01</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   rpi_i2c_set(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = BME280_ctrl_hum,</span></span>
<span><span class="co">#     value = sample_hum,</span></span>
<span><span class="co">#     data_size = "b"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # We always need temperature reading to compensate pressure &amp; humidity</span></span>
<span><span class="co"># # This turns on temperature reading</span></span>
<span><span class="co"># control_press_temp &lt;- bitwOr(control_press_temp,</span></span>
<span><span class="co">#                              strtoi("00100000", base = 2))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Get the pressure</span></span>
<span><span class="co">#   control_press_temp &lt;- bitwOr(control_press_temp,</span></span>
<span><span class="co">#                                strtoi("00000100", base = 2))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # tell BME280 to sense the requested temp/press/humidy</span></span>
<span><span class="co"># rpi_i2c_set(</span></span>
<span><span class="co">#   chip_address = BME280_location,</span></span>
<span><span class="co">#   data_address = control_measure_address,</span></span>
<span><span class="co">#   value = control_press_temp,</span></span>
<span><span class="co">#   data_size = "b"</span></span>
<span><span class="co"># )</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Raw temperature data (16-bit signed integer)</span></span>
<span><span class="co"># raw_temperature &lt;- rpi_i2c_get(chip_address = BME280_location,</span></span>
<span><span class="co">#                                data_address = 0xfa,</span></span>
<span><span class="co">#                                data_size = "w")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Calibration coefficients</span></span>
<span><span class="co"># dig_T1 &lt;- rpi_i2c_get(chip_address = BME280_location,</span></span>
<span><span class="co">#                       data_address = 0x88,</span></span>
<span><span class="co">#                       data_size = "w")</span></span>
<span><span class="co"># dig_T2 &lt;- rpi_i2c_get(chip_address = BME280_location,</span></span>
<span><span class="co">#                       data_address = 0x8A,</span></span>
<span><span class="co">#                       data_size = "w")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Temperature compensation</span></span>
<span><span class="co"># var1 &lt;- (raw_temperature / 16384 - dig_T1 / 1024) * dig_T2</span></span>
<span><span class="co"># var2 &lt;- ((raw_temperature / 131072 - dig_T1 / 8192) ^ 2) * dig_T2</span></span>
<span><span class="co"># t_fine &lt;- var1 + var2</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># if (getTemperature) {</span></span>
<span><span class="co">#   # Calculate temperature in degrees Celsius</span></span>
<span><span class="co">#   temperature_celsius &lt;- (t_fine / 5120)</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   # Raw pressure data (20-bit unsigned integer)</span></span>
<span><span class="co">#   raw_pressure &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xf7,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   # convert raw pressure to Pa</span></span>
<span><span class="co">#   # Calibration coefficients</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_P1 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0x8E,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_P2 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0x90,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_P3 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0x92,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_P4 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0x94,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_P5 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0x96,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_P6 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0x98,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_P7 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0x9A,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_P8 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0x9C,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_P9 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0x9E,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   # Calculate pressure --------</span></span>
<span><span class="co">#   var1 &lt;-</span></span>
<span><span class="co">#     t_fine / 2 - 64000 # t_fine is calculated by getTemperature</span></span>
<span><span class="co">#   var2 &lt;- var1 ^ 2 * dig_P6 / 32768</span></span>
<span><span class="co">#   var2 &lt;- var2 + (var1 * dig_P5) * 2</span></span>
<span><span class="co">#   var2 &lt;- (var2 / 4) + (dig_P4 * 65536)</span></span>
<span><span class="co">#   var1 &lt;- (dig_P3 * var1 ^ 2 / 524288 + dig_P2 * var1) / 524288</span></span>
<span><span class="co">#   var1 &lt;- (1 + var1 / 32768) * dig_P1</span></span>
<span><span class="co">#   pressure &lt;- 1048576 - raw_pressure</span></span>
<span><span class="co">#   pressure &lt;- ((pressure - (var2 / 4096)) * 6250) / var1</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   # Raw humidity data (16-bit unsigned integer)</span></span>
<span><span class="co">#   raw_humidity &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xfd,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   # convert humidity to relative humidity -------</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   # Calibration coefficients</span></span>
<span><span class="co">#   dig_H1 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xA1,</span></span>
<span><span class="co">#     data_size = "b"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_H2 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xE1,</span></span>
<span><span class="co">#     data_size = "w"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_H3 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xE3,</span></span>
<span><span class="co">#     data_size = "b"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   H4_msb &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xE4,</span></span>
<span><span class="co">#     data_size = "b"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   H4_lsb &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xE5,</span></span>
<span><span class="co">#     data_size = "b"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   dig_H4_msb &lt;- H4_msb * 16</span></span>
<span><span class="co">#   dig_H4_lsb &lt;- bitwAnd(H4_lsb, 0x0F)</span></span>
<span><span class="co">#   dig_H4 &lt;- bitwOr(dig_H4_msb, dig_H4_lsb)</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   H5_msb &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xE5,</span></span>
<span><span class="co">#     data_size = "b"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   H5_lsb &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xE6,</span></span>
<span><span class="co">#     data_size = "b"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   dig_H5_msb &lt;- H5_msb * 16</span></span>
<span><span class="co">#   dig_H5_lsb &lt;- bitShiftR(H5_lsb, 4)</span></span>
<span><span class="co">#   dig_H5 &lt;- bitwOr(dig_H5_msb, dig_H5_lsb)</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   dig_H6 &lt;- rpi_i2c_get(</span></span>
<span><span class="co">#     chip_address = BME280_location,</span></span>
<span><span class="co">#     data_address = 0xE7,</span></span>
<span><span class="co">#     data_size = "b"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   # Calculate humidity</span></span>
<span><span class="co">#   var1 &lt;- t_fine - 76800.0</span></span>
<span><span class="co">#   var2 &lt;- dig_H4 * 64.0 + (dig_H5 / 16384.0) * var1</span></span>
<span><span class="co">#   var3 &lt;- raw_humidity - var2</span></span>
<span><span class="co">#   var4 &lt;- dig_H2 / 65536.0</span></span>
<span><span class="co">#   var5 &lt;- 1.0 + (dig_H3 / 67108864.0) * var1</span></span>
<span><span class="co">#   var6 &lt;- 1.0 + (dig_H6 / 67108864.0) * var1 * var5</span></span>
<span><span class="co">#   var6 &lt;- var3 * var4 * (var5 * var6)</span></span>
<span><span class="co">#   humidity &lt;- var6 * (1.0 - dig_H1 * var6 / 524288.0)</span></span>
<span><span class="co">#   </span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mark Niemann-Ross.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
